<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Afro Index | Teams with 5+ Consecutive Wins</title>
    <meta name="description"
        content="Tracking every team that achieved 5+ consecutive wins since Frank Ilett's famous hair vow on October 5, 2024.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'united-red': '#DA291C',
                        'neon-green': '#00ff9d',
                        'dark-bg': '#050505',
                        'dark-card': '#0a0a0a',
                        'dark-border': '#1a1a1a'
                    },
                    fontFamily: {
                        'display': ['Inter', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: #050505;
            font-family: 'Inter', sans-serif;
        }

        /* Gradient background */
        .hero-gradient {
            background: radial-gradient(ellipse at top, rgba(218, 41, 28, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(0, 255, 157, 0.05) 0%, transparent 40%);
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(218, 41, 28, 0.3);
            transform: translateY(-4px);
        }

        /* Glowing text */
        .glow-red {
            text-shadow: 0 0 40px rgba(218, 41, 28, 0.5);
        }

        .glow-green {
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
        }

        /* Animated gradient border */
        .gradient-border {
            position: relative;
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #DA291C, #00ff9d, #DA291C);
            border-radius: inherit;
            z-index: -1;
            animation: border-rotate 3s linear infinite;
            background-size: 200% 200%;
        }

        @keyframes border-rotate {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Pulse animation for scan button */
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(218, 41, 28, 0.4);
            }

            50% {
                box-shadow: 0 0 40px rgba(218, 41, 28, 0.6);
            }
        }

        /* Tab styles */
        .tab-active {
            background: rgba(218, 41, 28, 0.2);
            border-color: rgba(218, 41, 28, 0.5);
        }

        /* Streak badge */
        .streak-badge {
            background: linear-gradient(135deg, #00ff9d 0%, #00cc7d 100%);
            animation: badge-pulse 2s infinite;
        }

        @keyframes badge-pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #DA291C;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #DA291C;
        }
    </style>
</head>

<body class="min-h-screen text-white">
    <!-- Hero Section (Compact) -->
    <section class="hero-gradient py-16 md:py-24">
        <!-- Nav -->
        <nav class="flex justify-between items-center px-6 py-4 md:px-12 absolute top-0 left-0 right-0">
            <div class="font-mono text-sm text-gray-500">v1.0</div>
            <a href="https://github.com/ArmaanSethi/afro-index" target="_blank"
                class="text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd"
                        d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                        clip-rule="evenodd" />
                </svg>
            </a>
        </nav>

        <!-- Hero Content -->
        <div class="flex flex-col items-center justify-center px-6 text-center pt-12">
            <span class="inline-block px-4 py-2 rounded-full glass text-sm font-mono text-gray-400 mb-4">
                üî¥ LIVE TRACKING
            </span>

            <!-- Man United Crest -->
            <img src="https://crests.football-data.org/66.png" alt="Manchester United"
                class="w-20 h-20 mb-4 opacity-30 grayscale hover:opacity-100 hover:grayscale-0 transition-all cursor-pointer"
                title="Still waiting...">

            <h1 class="text-4xl md:text-6xl lg:text-7xl font-black tracking-tight mb-3 glow-red">
                THE <span class="text-united-red">AFRO</span> INDEX
            </h1>
            <p class="text-lg md:text-xl text-gray-400 max-w-xl mx-auto mb-2">
                Every team that's done what United can't
            </p>
            <a href="https://www.google.com/search?q=frank+ilett+hair+manchester+united" target="_blank"
                class="text-xs text-gray-600 hover:text-united-red transition-colors mb-8 inline-block">
                The Vow: Oct 5, 2024 ‚Üí ???
            </a>

            <!-- Stats -->
            <div class="flex flex-wrap justify-center gap-8 md:gap-16">
                <div class="text-center">
                    <div id="team-count" class="text-3xl md:text-5xl font-black text-neon-green glow-green font-mono">
                        --
                    </div>
                    <div class="text-xs text-gray-500 uppercase tracking-wider mt-1">Teams Found</div>
                </div>
                <div class="text-center">
                    <div id="days-count" class="text-3xl md:text-5xl font-black text-united-red glow-red font-mono">
                        --
                    </div>
                    <div class="text-xs text-gray-500 uppercase tracking-wider mt-1">Days & Counting</div>
                </div>
                <div class="text-center">
                    <div id="leagues-count" class="text-3xl md:text-5xl font-black text-white font-mono">
                        --
                    </div>
                    <div class="text-xs text-gray-500 uppercase tracking-wider mt-1">Leagues Scanned</div>
                </div>
            </div>

            <div class="mt-8 text-xs text-gray-500 font-mono">
                Last Updated: <span id="last-updated" class="text-gray-300">--</span>
            </div>
        </div>
    </section>

    <!-- Leaderboard Section -->
    <section class="py-20 px-6 md:px-12">
        <div class="max-w-7xl mx-auto">
            <!-- Section Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12">
                <div>
                    <h2 class="text-3xl md:text-4xl font-bold mb-2">The Leaderboard</h2>
                    <p class="text-gray-500">Teams that achieved 5+ consecutive wins</p>
                </div>

                <!-- Tabs -->
                <div class="flex gap-2 mt-6 md:mt-0">
                    <button class="tab-btn tab-active px-6 py-3 rounded-xl glass font-semibold transition-all"
                        data-tab="football">
                        ‚öΩ Football
                    </button>
                    <button
                        class="tab-btn px-6 py-3 rounded-xl glass font-semibold transition-all text-gray-500 hover:text-white"
                        data-tab="other">
                        üèÄüèàüèí Other
                    </button>
                </div>
            </div>

            <!-- Football Grid -->
            <div id="football-tab" class="tab-content">
                <div id="teams-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Teams will be loaded here -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="hidden text-center py-20">
                    <div class="text-6xl mb-4">‚öΩ</div>
                    <h3 class="text-xl font-semibold mb-2">Loading teams...</h3>
                    <p class="text-gray-500">Teams will appear here once data is loaded.</p>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="flex justify-center py-20">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- Other Sports Tab -->
            <div id="other-tab" class="tab-content hidden">
                <div class="text-center py-20 glass rounded-2xl">
                    <div class="text-6xl mb-6">üèÄ üèà üèí ‚öæ</div>
                    <h3 class="text-2xl font-bold mb-3">Coming Soon</h3>
                    <p class="text-gray-400 max-w-lg mx-auto mb-6">
                        NBA, NFL, NHL, and MLB tracking is on the roadmap.<br>
                        Same concept: teams that achieved 5+ consecutive wins while United waits.
                    </p>
                    <div class="inline-block px-4 py-2 rounded-full glass text-sm text-gray-500">
                        <span class="text-neon-green">‚óè</span> API infrastructure ready ‚Ä¢ Just need more API credits
                    </div>
                    <p class="text-gray-600 text-xs mt-6">
                        Want this faster? <a href="https://github.com/ArmaanSethi/afro-index"
                            class="text-united-red hover:underline">Star the repo</a> or sponsor the project!
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 px-6 md:px-12 bg-gradient-to-b from-transparent to-dark-card">
        <div class="max-w-4xl mx-auto">
            <div class="glass rounded-3xl p-8 md:p-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 text-center">The Story</h2>

                <div class="space-y-6 text-gray-300 leading-relaxed">
                    <p>
                        <span class="text-2xl mr-2">üíá</span>
                        On <span class="text-united-red font-semibold">October 5, 2024</span>, Manchester United fan
                        <span class="text-white font-semibold">Frank Ilett</span> made a bold vow: he would not cut
                        his hair until United won <span class="text-neon-green font-semibold">5 games in a row</span>.
                    </p>

                    <p>
                        <span class="text-2xl mr-2">‚è≥</span>
                        As of today, <span id="days-inline" class="text-united-red font-bold">--</span> days later,
                        Frank is still waiting. His hair grows longer with each disappointing result.
                    </p>

                    <p>
                        <span class="text-2xl mr-2">üìä</span>
                        Meanwhile, we've been tracking every other team in the world that has managed to achieve
                        this seemingly impossible feat. Spoiler alert: it's a lot of teams.
                    </p>

                    <p>
                        <span class="text-2xl mr-2">üéØ</span>
                        <span class="text-white font-semibold">The Afro Index</span> exists to document this journey.
                        Every team that reaches 5 consecutive wins gets added to our leaderboard, proving that
                        Frank's challenge really shouldn't be this hard.
                    </p>
                </div>

                <div class="mt-10 pt-8 border-t border-white/10 text-center">
                    <p class="text-gray-500 font-mono text-sm">
                        Data sourced from football-data.org ‚Ä¢ Auto-updated
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Status Section -->
    <section class="max-w-7xl mx-auto px-6 md:px-12 pb-20">
        <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-neon-green animate-pulse"></span>
            Live Coverage Status
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="leagues-status">
            <!-- Loading... -->
            <div class="glass p-4 rounded-xl flex items-center justify-between opacity-50">
                <span>Loading coverage data...</span>
            </div>
        </div>

        <p class="text-xs text-gray-500 mt-6">
            We scan 12 major competitions (Free Tier Limit): Premier League, La Liga, Bundesliga, Serie A, Ligue 1,
            Eredivisie, Primeira Liga, Championship, Champions League, Euro Championship, World Cup, and Brasileir√£o.
        </p>
    </section>

    <!-- Footer -->
    <footer class="py-8 px-6 text-center border-t border-white/5">
        <p class="text-gray-600 font-mono text-sm">
            Built for <span class="text-united-red">The United Strand</span> üî¥
        </p>
        <p class="text-gray-700 text-xs mt-2">
            Data from <a href="https://football-data.org" class="text-gray-500 hover:text-white">football-data.org</a> ‚Ä¢
            Auto-updated
        </p>
    </footer>

    <script>
        // Constants
        const START_DATE = new Date('2024-10-05');
        const API_BASE = '/api';

        // DOM Elements
        const teamCountEl = document.getElementById('team-count');
        const daysCountEl = document.getElementById('days-count');
        const leaguesCountEl = document.getElementById('leagues-count');
        const lastUpdatedEl = document.getElementById('last-updated');
        const leaguesStatusEl = document.getElementById('leagues-status');
        const daysInlineEl = document.getElementById('days-inline');
        const teamsGridEl = document.getElementById('teams-grid');
        const emptyStateEl = document.getElementById('empty-state');
        const loadingStateEl = document.getElementById('loading-state');

        // Calculate days since start
        function calculateDays() {
            const now = new Date();
            const diffTime = Math.abs(now - START_DATE);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update days display
        function updateDays() {
            const days = calculateDays();
            daysCountEl.textContent = days;
            if (daysInlineEl) daysInlineEl.textContent = days;
        }

        // Render team card
        // Render team card
        function renderTeamCard(team) {
            const maxStreak = team.max_streak || 5;

            // Calculate days since Frank's vow when streak was achieved
            let dayBadge = '';
            if (team.streak_achieved_date) {
                const achievedDate = new Date(team.streak_achieved_date);
                const daysSinceStart = Math.floor((achievedDate - START_DATE) / (1000 * 60 * 60 * 24));
                const formattedDate = achievedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                dayBadge = `<span class="px-3 py-1 rounded-full text-sm font-bold bg-blue-500/20 text-blue-300" title="Achieved on ${formattedDate}">üìÖ Day ${daysSinceStart}</span>`;
            }

            return `
        <div class="glass-card rounded-2xl p-6 cursor-default hover:scale-[1.02] transition-transform flex flex-col">
          <div class="flex items-start justify-between mb-4">
            <img src="${team.logo}" alt="${team.name}" 
                 class="w-16 h-16 object-contain bg-white/5 rounded-xl p-2"
                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>‚öΩ</text></svg>'">
            ${dayBadge}
          </div>
          
          <h3 class="font-bold text-lg mb-2 truncate" title="${team.name}">${team.name}</h3>
          
          <div class="flex items-center gap-2 text-sm text-gray-400 mb-2">
            ${team.country_flag ? `<img src="${team.country_flag}" class="w-5 h-4 rounded" alt="">` : ''}
            <span>${team.country_name || 'Unknown'}</span>
          </div>
          
          <div class="flex justify-between items-end mt-auto">
            <div class="text-xs text-gray-500">
              ${team.league_name || 'Unknown League'}
            </div>
            <span class="streak-badge px-3 py-1 rounded-full text-sm font-bold text-black">
              ${maxStreak}W üî•
            </span>
          </div>
        </div>
      `;
        }

        // Fetch and render teams
        async function loadTeams() {
            loadingStateEl.classList.remove('hidden');
            emptyStateEl.classList.add('hidden');
            teamsGridEl.innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/teams`);
                const data = await res.json();

                loadingStateEl.classList.add('hidden');

                if (data.teams && data.teams.length > 0) {
                    teamCountEl.textContent = data.teams.length;
                    if (data.leaguesScanned) {
                        leaguesCountEl.textContent = data.leaguesScanned;
                    }
                    teamsGridEl.innerHTML = data.teams.map(renderTeamCard).join('');
                    emptyStateEl.classList.add('hidden');

                    // üéâ Easter egg: Check if Manchester United made it!
                    const unitedMadeIt = data.teams.find(t => t.team_id === 66 || t.name.includes('Manchester United'));
                    if (unitedMadeIt) {
                        document.body.innerHTML = `
                            <div class="fixed inset-0 bg-united-red flex items-center justify-center z-50">
                                <div class="text-center text-white p-8">
                                    <div class="text-9xl mb-8">üéâ‚úÇÔ∏èüéâ</div>
                                    <h1 class="text-6xl font-black mb-4">FRANK CAN CUT HIS HAIR!</h1>
                                    <p class="text-2xl mb-8">Manchester United finally won 5 in a row!</p>
                                    <p class="text-xl opacity-75">It only took ${calculateDays()} days...</p>
                                    <button onclick="location.reload()" class="mt-8 px-8 py-4 bg-white text-united-red font-bold rounded-xl hover:scale-105 transition-transform">
                                        View The Leaderboard
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    teamsGridEl.innerHTML = '';
                    teamCountEl.textContent = '0';
                    emptyStateEl.classList.remove('hidden');
                }

                // Render Recent Scans
                if (data.recentScans && data.recentScans.length > 0) {
                    // Update Last Updated time
                    const lastScan = new Date(data.recentScans[0].scanned_at);
                    if (lastUpdatedEl) lastUpdatedEl.textContent = lastScan.toLocaleString();

                    // Trigger auto-scan if data is stale
                    autoScan(lastScan);

                    // Render grid
                    if (leaguesStatusEl) {
                        leaguesStatusEl.innerHTML = data.recentScans.map(scan => {
                            const date = new Date(scan.scanned_at);
                            return `
                        <div class="glass p-4 rounded-xl flex items-center justify-between">
                            <div>
                                <div class="font-bold text-sm text-neon-green">${scan.league_name || scan.league_id}</div>
                                <div class="text-xs text-gray-500">${date.toLocaleTimeString()}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs font-mono text-white">${scan.teams_qualified} qualified</div>
                                <div class="text-[10px] text-gray-600">${scan.teams_scanned} scanned</div>
                            </div>
                        </div>
                        `;
                        }).join('');
                    }
                } else {
                    // No scans yet, trigger auto-scan
                    autoScan(null);
                }
            } catch (error) {
                console.error('Failed to load teams:', error);
                loadingStateEl.classList.add('hidden');
                teamCountEl.textContent = '0';
                emptyStateEl.classList.remove('hidden');
            }
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('tab-active');
                    b.classList.add('text-gray-500');
                });
                btn.classList.add('tab-active');
                btn.classList.remove('text-gray-500');

                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${btn.dataset.tab}-tab`).classList.remove('hidden');
            });
        });

        // Auto-scan: trigger a background scan if data is stale
        const SCAN_INTERVAL_MINUTES = 5; // Scan if no scan in last 5 minutes

        async function autoScan(lastScanTime) {
            if (!lastScanTime) {
                console.log('No scan data, triggering auto-scan...');
                triggerBackgroundScan();
                return;
            }

            const minutesSinceLastScan = (new Date() - lastScanTime) / 60000;
            console.log(`Last scan was ${minutesSinceLastScan.toFixed(1)} minutes ago`);

            if (minutesSinceLastScan > SCAN_INTERVAL_MINUTES) {
                console.log('Data is stale, triggering auto-scan...');
                triggerBackgroundScan();
            }
        }

        async function triggerBackgroundScan() {
            try {
                const res = await fetch(`${API_BASE}/scan`);
                const data = await res.json();
                if (data.success) {
                    console.log(`Auto-scanned: ${data.competition.name} - ${data.teamsQualified} teams qualified`);
                    // Reload teams to show new data
                    loadTeams();
                }
            } catch (error) {
                console.error('Auto-scan failed:', error);
            }
        }

        // Init
        updateDays();
        loadTeams();
    </script>
</body>

</html>